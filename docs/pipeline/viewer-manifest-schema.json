{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schema.virtualtour.ai/v1/viewer-manifest.json",
  "x-model": "virtualtour.viewer.manifest",
  "x-version": "v1.1.0",
  "title": "VirtualTour Viewer Manifest Schema",
  "type": "object",
  "required": [
    "space_id",
    "version",
    "owner",
    "created_at",
    "share_url",
    "embed_allowed",
    "embed_snippet_template",
    "geometry",
    "textures",
    "navigation",
    "views",
    "hotspots",
    "measurements",
    "access"
  ],
  "properties": {
    "space_id": {
      "type": "string",
      "description": "Unique ID for the space."
    },
    "version": {
      "type": "string",
      "description": "Manifest version and revision number (e.g., v1.0.0)."
    },
    "owner": {
      "type": "string",
      "description": "User or organization that owns this space."
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    },
    "share_url": {
      "type": "string",
      "format": "uri",
      "description": "Canonical share link that respects ACL tokens."
    },
    "embed_allowed": {
      "type": "boolean",
      "description": "Indicates if the space owner has permitted iframe/embed usage."
    },
    "embed_snippet_template": {
      "type": "object",
      "required": ["iframe", "javascript", "parameters"],
      "properties": {
        "iframe": {
          "type": "string",
          "description": "Responsive iframe HTML snippet including default query parameters."
        },
        "javascript": {
          "type": "string",
          "description": "Async widget embed code for advanced integrations."
        },
        "responsive_css": {
          "type": "string",
          "description": "Optional CSS helper that enforces responsive sizing using aspect-ratio padding."
        },
        "parameters": {
          "type": "array",
          "description": "Supported query or data attribute overrides for the embed layer.",
          "items": {
            "type": "object",
            "required": ["key", "type"],
            "properties": {
              "key": {
                "type": "string",
                "description": "Embed parameter key (e.g., start, mode, branding)."
              },
              "type": {
                "type": "string",
                "enum": ["string", "boolean", "number"],
                "description": "Parameter value type."
              },
              "default": {
                "type": ["string", "boolean", "number", "null"],
                "description": "Default value applied in the generated snippet."
              },
              "description": {
                "type": "string",
                "description": "Human-readable explanation of what the parameter controls."
              },
              "options": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Enumerated options if the parameter is constrained to specific values."
              }
            }
          }
        }
      }
    },
    "geometry": {
      "type": "object",
      "required": ["lod_levels", "mesh_tiles"],
      "properties": {
        "lod_levels": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "level": { "type": "integer" },
              "triangle_count": { "type": "integer" },
              "tile_size": { "type": "integer" },
              "description": { "type": "string" }
            }
          }
        },
        "mesh_tiles": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "tile_id": { "type": "string" },
              "url": { "type": "string" },
              "lod": { "type": "integer" },
              "bounds": {
                "type": "array",
                "items": { "type": "number" },
                "description": "Bounding box coordinates [minX, minY, minZ, maxX, maxY, maxZ]"
              }
            }
          }
        }
      }
    },
    "textures": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "lod": { "type": "integer" },
          "url": { "type": "string" },
          "resolution": { "type": "string", "description": "Resolution, e.g., 1024x1024" },
          "format": { "type": "string", "enum": ["jpg", "png", "ktx2", "basisu"] }
        }
      }
    },
    "navigation": {
      "type": "object",
      "required": ["camera_nodes", "connections"],
      "properties": {
        "camera_nodes": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id", "position", "rotation"],
            "properties": {
              "id": { "type": "string" },
              "position": {
                "type": "array",
                "items": { "type": "number" },
                "description": "[x, y, z] coordinates of camera node"
              },
              "rotation": {
                "type": "array",
                "items": { "type": "number" },
                "description": "[pitch, yaw, roll] in radians"
              },
              "fov": { "type": "number", "description": "Field of view in degrees" },
              "thumbnail": { "type": "string", "description": "Preview image URL" },
              "zone_id": { "type": "string", "description": "Zone association for the node." }
            }
          }
        },
        "connections": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "from": { "type": "string" },
              "to": { "type": "string" },
              "transition_type": { "type": "string", "enum": ["WALK", "STAIR", "TELEPORT"] },
              "distance": { "type": "number" },
              "zone_transition": {
                "type": "boolean",
                "description": "Indicates the connection crosses into a different zone."
              }
            }
          }
        }
      }
    },
    "views": {
      "type": "object",
      "required": ["walkthrough", "dollhouse", "floorplan"],
      "properties": {
        "walkthrough": {
          "type": "object",
          "properties": {
            "default_node": { "type": "string" },
            "pathfinding_enabled": { "type": "boolean" }
          }
        },
        "dollhouse": {
          "type": "object",
          "properties": {
            "model_url": { "type": "string" },
            "scale_factor": { "type": "number" },
            "supports_floor_toggle": { "type": "boolean" }
          }
        },
        "floorplan": {
          "type": "object",
          "properties": {
            "projection_url": { "type": "string" },
            "room_polygons": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "room_id": { "type": "string" },
                  "name": { "type": "string" },
                  "points": {
                    "type": "array",
                    "items": { "type": "array", "items": { "type": "number" } },
                    "description": "List of 2D coordinates for room polygon"
                  }
                }
              }
            }
          }
        }
      }
    },
    "hotspots": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "type": { "type": "string", "enum": ["INFO", "LINK", "VIDEO", "IMAGE", "AUDIO", "PRODUCT"] },
          "title": { "type": "string" },
          "content": { "type": "string" },
          "position": {
            "type": "array",
            "items": { "type": "number" },
            "description": "[x, y, z] world coordinates"
          },
          "media_url": { "type": "string" },
          "visible_in_views": {
            "type": "array",
            "items": { "type": "string", "enum": ["walkthrough", "dollhouse", "floorplan"] }
          },
          "author": { "type": "string" },
          "created_at": { "type": "string", "format": "date-time" }
        }
      }
    },
    "measurements": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "point_a": { "type": "array", "items": { "type": "number" } },
          "point_b": { "type": "array", "items": { "type": "number" } },
          "distance_meters": { "type": "number" },
          "created_by": { "type": "string" }
        }
      }
    },
    "analytics": {
      "type": "object",
      "properties": {
        "views_count": { "type": "integer" },
        "average_dwell_time": { "type": "number" },
        "click_heatmap_url": { "type": "string" }
      }
    },
    "zones": {
      "type": "array",
      "description": "Zones that compose the unified multi-space tour.",
      "items": {
        "type": "object",
        "required": ["zone_id", "name", "space_ids", "outdoor"],
        "properties": {
          "zone_id": { "type": "string" },
          "name": { "type": "string" },
          "space_ids": {
            "type": "array",
            "items": { "type": "string" },
            "minItems": 1
          },
          "default_space_id": { "type": "string" },
          "outdoor": { "type": "boolean" },
          "site_zone_identifier": { "type": "string" },
          "campus_map_icon_url": { "type": "string" },
          "gps_bounds": {
            "type": "object",
            "properties": {
              "sw": {
                "type": "object",
                "required": ["latitude", "longitude"],
                "properties": {
                  "latitude": { "type": "number" },
                  "longitude": { "type": "number" }
                },
                "additionalProperties": false
              },
              "ne": {
                "type": "object",
                "required": ["latitude", "longitude"],
                "properties": {
                  "latitude": { "type": "number" },
                  "longitude": { "type": "number" }
                },
                "additionalProperties": false
              },
              "altitude_meters": { "type": "number" }
            },
            "additionalProperties": false
          },
          "capture_metadata": {
            "type": "object",
            "properties": {
              "captureDate": { "type": "string", "format": "date" },
              "captureCrew": { "type": "string" },
              "sunOrientation": {
                "type": "object",
                "properties": {
                  "azimuthDegrees": { "type": "number" },
                  "elevationDegrees": { "type": "number" },
                  "capturedAt": { "type": "string", "format": "date-time" }
                },
                "additionalProperties": false
              },
              "weather": {
                "type": "string",
                "enum": ["CLEAR", "PARTLY_CLOUDY", "OVERCAST", "RAIN", "SNOW", "FOG", "WINDY"]
              },
              "gpsTrackUrl": { "type": "string" },
              "measurementToleranceCm": { "type": "number" },
              "calibrationMethod": {
                "type": "string",
                "enum": ["GPS", "TOTAL_STATION", "HYBRID", "NONE"]
              }
            },
            "additionalProperties": false
          }
        }
      }
    },
    "zone_connections": {
      "type": "array",
      "description": "Graph describing how viewers may transition between zones.",
      "items": {
        "type": "object",
        "required": ["from_zone_id", "to_zone_id", "transition_type"],
        "properties": {
          "from_zone_id": { "type": "string" },
          "to_zone_id": { "type": "string" },
          "transition_type": { "type": "string", "enum": ["WALK", "PATH", "TELEPORT"] },
          "description": { "type": "string" },
          "estimated_seconds": { "type": "number" },
          "distance_meters": { "type": "number" }
        }
      }
    },
    "campus_map": {
      "type": "object",
      "description": "Campus map metadata for multi-zone navigation.",
      "properties": {
        "image_url": { "type": "string" },
        "tile_url_template": { "type": "string" },
        "default_zone_id": { "type": "string" },
        "gps_bounds": {
          "type": "object",
          "properties": {
            "sw": {
              "type": "object",
              "required": ["latitude", "longitude"],
              "properties": {
                "latitude": { "type": "number" },
                "longitude": { "type": "number" }
              },
              "additionalProperties": false
            },
            "ne": {
              "type": "object",
              "required": ["latitude", "longitude"],
              "properties": {
                "latitude": { "type": "number" },
                "longitude": { "type": "number" }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "outdoor_flag": {
      "type": "boolean",
      "description": "Indicates the manifest represents an outdoor or mixed environment."
    },
    "performance": {
      "type": "object",
      "description": "Performance tuning profile for streaming large outdoor scenes.",
      "properties": {
        "lod_target_triangle_budget": { "type": "integer" },
        "max_texture_resolution": { "type": "integer" },
        "mobile_max_texture_resolution": { "type": "integer" },
        "streaming_chunk_bytes": { "type": "integer" }
      },
      "additionalProperties": false
    },
    "access": {
      "type": "object",
      "required": ["token", "permissions", "expiry"],
      "properties": {
        "token": { "type": "string" },
        "permissions": {
          "type": "array",
          "items": { "type": "string", "enum": ["view", "measure", "comment", "admin"] }
        },
        "expiry": { "type": "string", "format": "date-time" }
      }
    }
  }
}
